---
title: "Data Cleaning and Exploration"
author: "Casey Bates"
date: '2019-02-03'
slug: data-cleaning-and-exploration
tags:
- tidyverse
- ggplot2
- dplyr
- data cleaning
categories: R
---



<p>This blog post covers the steps taken to prepare two home sales data sets for analysis. If you’re only interested in fitting and visualizing multiple models with <code>purrr</code> and <code>broom</code>, skip ahead to that post.</p>
<div id="processing-the-data" class="section level2">
<h2>Processing the data</h2>
<p>A single-family home sales dataset and a condo/townhome dataset for Garfield County, Colorado, that contain 2 years of data from summer 2014 through summer 2016. The data is publically available on the <a href="https://www.garfield-county.com/assessor/comparable-sales.aspx">Garfield County Assessor website</a>.</p>
<p>Load the required packages, read in the datasets, and take a glimpse at the <code>townhomes</code> data frame.</p>
<pre class="r"><code># This chunk includes the data processing steps to wrangle and clean the data
library(tidyverse) # For reading-in, wrangling, visualizing the data, and for pipe operator
library(readxl) # Tidyverse package for reading in Excel files
library(magrittr) # For the &#39;%&lt;&gt;%&#39; pipe operator
library(knitr) # For nicely formatted tables

# Read-in townhomes and condo sales data
townhomes &lt;- read_xlsx(&quot;2017-comparable-sales-condos-townhomes.xlsx&quot;) 

# Read-in single family home sales data
single_family &lt;- read_xlsx(&quot;2017-comparable-sales-single-family.xlsx&quot;) 

# Check column names and formats
glimpse(townhomes) </code></pre>
<pre><code>## Observations: 606
## Variables: 14
## $ Account               &lt;chr&gt; &quot;R007341&quot;, &quot;R340686&quot;, &quot;R045341&quot;, &quot;R34080...
## $ `Parcel Number`       &lt;chr&gt; &quot;239334430001&quot;, &quot;239334350003&quot;, &quot;2393343...
## $ Reception             &lt;dbl&gt; 852413, 871451, 861415, 872689, 875851, ...
## $ `Sale Date`           &lt;chr&gt; &quot;8/8/2014&quot;, &quot;12/11/2015&quot;, &quot;4/14/2015&quot;, &quot;...
## $ `Sale Price`          &lt;dbl&gt; 210000, 265000, 308500, 160000, 340000, ...
## $ `Situs Address`       &lt;chr&gt; &quot;000133 SOPRIS AVE #A&quot;, &quot;213 1/2 N 10TH ...
## $ Location              &lt;chr&gt; &quot;CARBONDALE&quot;, &quot;CARBONDALE&quot;, &quot;CARBONDALE&quot;...
## $ Classification        &lt;chr&gt; &quot;Condo&quot;, &quot;Condo&quot;, &quot;Condo&quot;, &quot;Condo&quot;, &quot;Con...
## $ `Architectural Style` &lt;chr&gt; &quot;CONDO&quot;, &quot;CONDO&quot;, &quot;CONDO&quot;, &quot;CONDO&quot;, &quot;CON...
## $ `Actual Year Built`   &lt;dbl&gt; 1974, 1980, 2008, 1981, 2007, 2007, 2007...
## $ Bedrooms              &lt;dbl&gt; 1, 1, 1, 1, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2...
## $ Baths                 &lt;dbl&gt; 1.00, 1.00, 1.00, 1.00, 1.00, 1.00, 2.00...
## $ `Heated Area`         &lt;dbl&gt; 621, 732, 792, 800, 864, 864, 891, 918, ...
## $ Legal                 &lt;chr&gt; &quot;Section: 34 Township: 7 Range: 88 DESC:...</code></pre>
<p>Column names will be cleaned up in a later step to make everything lower case and remove spaces. In this series of blog posts we will be evaluating how well square footage predicts sale price. Both sale price and “heated area” which represents liveable square footage are in numeric (double) format. This is a good start.</p>
<p>Now to take a look at the single family homes data frame.</p>
<pre class="r"><code>glimpse(single_family)</code></pre>
<pre><code>## Observations: 1,369
## Variables: 13
## $ Account               &lt;chr&gt; &quot;R340967&quot;, &quot;R340073&quot;, &quot;R112063&quot;, &quot;R58014...
## $ `Parcel Number`       &lt;chr&gt; &quot;239334401005&quot;, &quot;239334200010&quot;, &quot;2393351...
## $ Reception             &lt;chr&gt; &quot;879240&quot;, &quot;870778&quot;, &quot;869383&quot;, &quot;857328&quot;, ...
## $ `Sale Date`           &lt;chr&gt; &quot;6/29/2016&quot;, &quot;11/24/2015&quot;, &quot;10/13/2015&quot;,...
## $ `Sale Price`          &lt;dbl&gt; 650000, 560000, 2750000, 630500, 2800000...
## $ `Situs Address`       &lt;chr&gt; &quot;000066 N 2ND ST&quot;, &quot;000276 10TH ST&quot;, &quot;00...
## $ Location              &lt;chr&gt; &quot;CARBONDALE&quot;, &quot;CARBONDALE&quot;, &quot;CARBONDALE&quot;...
## $ `Architectural Style` &lt;chr&gt; &quot;ONE STORY&quot;, &quot;ONE STORY&quot;, &quot;ONE STORY&quot;, &quot;...
## $ `Year Built`          &lt;dbl&gt; 1970, 1971, 2002, 1999, 2008, 1994, 1993...
## $ Bedrooms              &lt;dbl&gt; 0, 1, 0, 1, 2, 1, 1, 1, 2, 2, 1, 2, 2, 2...
## $ Baths                 &lt;dbl&gt; 0.00, 1.00, 0.75, 1.00, 1.00, 1.00, 1.00...
## $ `Heated Area`         &lt;dbl&gt; 0, 480, 680, 710, 764, 804, 825, 957, 96...
## $ Legal                 &lt;chr&gt; &quot;Section: 34 Township: 7 Range: 88 Subdi...</code></pre>
<p>A nice feature of the <code>readxl</code> package is that the sale price column was coerced to numeric and the special characters ‘$’ and ’,’were removed. This saves us some effort. Now to clean up the column names.</p>
<pre class="r"><code># Replace spaces in column names with underscores (&#39;_&#39;) and make names lowercase
# the package &#39;magrittr&#39; is used for the pipe operator
colnames(townhomes) %&lt;&gt;% str_replace_all(&quot;\\s&quot;, &quot;_&quot;) %&lt;&gt;% tolower() 
colnames(single_family) %&lt;&gt;% str_replace_all(&quot;\\s&quot;, &quot;_&quot;) %&lt;&gt;% tolower()</code></pre>
<p>Rename column <code>actual_year_built</code> as <code>year_built</code> for consistency between datasets.</p>
<pre class="r"><code>townhomes &lt;- townhomes %&gt;% 
  rename(year_built = actual_year_built)</code></pre>
<p>Add a <code>classifcation</code> column to the single_family dataset and set all values to “Single Family”.</p>
<pre class="r"><code>single_family &lt;- single_family %&gt;% 
  mutate(classification = &quot;Single Family&quot;)</code></pre>
<p>bind_rows() throws an error b/c <code>reception</code> column is numeric in townhomes dataset; convert to character.</p>
<pre class="r"><code>townhomes$reception &lt;- as.character(townhomes$reception)</code></pre>
<p>Combine the datasets into one.</p>
<pre class="r"><code>home_sales &lt;- bind_rows(single_family, townhomes)
glimpse(home_sales)</code></pre>
<pre><code>## Observations: 1,975
## Variables: 14
## $ account             &lt;chr&gt; &quot;R340967&quot;, &quot;R340073&quot;, &quot;R112063&quot;, &quot;R580140&quot;...
## $ parcel_number       &lt;chr&gt; &quot;239334401005&quot;, &quot;239334200010&quot;, &quot;239335100...
## $ reception           &lt;chr&gt; &quot;879240&quot;, &quot;870778&quot;, &quot;869383&quot;, &quot;857328&quot;, &quot;8...
## $ sale_date           &lt;chr&gt; &quot;6/29/2016&quot;, &quot;11/24/2015&quot;, &quot;10/13/2015&quot;, &quot;...
## $ sale_price          &lt;dbl&gt; 650000, 560000, 2750000, 630500, 2800000, ...
## $ situs_address       &lt;chr&gt; &quot;000066 N 2ND ST&quot;, &quot;000276 10TH ST&quot;, &quot;0008...
## $ location            &lt;chr&gt; &quot;CARBONDALE&quot;, &quot;CARBONDALE&quot;, &quot;CARBONDALE&quot;, ...
## $ architectural_style &lt;chr&gt; &quot;ONE STORY&quot;, &quot;ONE STORY&quot;, &quot;ONE STORY&quot;, &quot;ON...
## $ year_built          &lt;dbl&gt; 1970, 1971, 2002, 1999, 2008, 1994, 1993, ...
## $ bedrooms            &lt;dbl&gt; 0, 1, 0, 1, 2, 1, 1, 1, 2, 2, 1, 2, 2, 2, ...
## $ baths               &lt;dbl&gt; 0.00, 1.00, 0.75, 1.00, 1.00, 1.00, 1.00, ...
## $ heated_area         &lt;dbl&gt; 0, 480, 680, 710, 764, 804, 825, 957, 960,...
## $ legal               &lt;chr&gt; &quot;Section: 34 Township: 7 Range: 88 Subdivi...
## $ classification      &lt;chr&gt; &quot;Single Family&quot;, &quot;Single Family&quot;, &quot;Single ...</code></pre>
<p>No new columns were created during the ‘bind_rows()’ process, indicating all colums align. Remove single_family and townhomes dataframes because they are no longer needed.</p>
<pre class="r"><code>rm(single_family, townhomes)</code></pre>
<p><code>unique(home_sales$classification)</code> reveals a “Garage Only” type. Drop this.</p>
<pre class="r"><code>home_sales &lt;- home_sales %&gt;% filter(classification != &quot;Garage Only&quot;) </code></pre>
<p>Rename the column <code>heated_area</code> to <code>square_feet</code> for clarity, though technically not correct</p>
<pre class="r"><code>home_sales &lt;- home_sales %&gt;% 
  rename(square_feet = heated_area)</code></pre>
</div>
<div id="processing-the-data---recap" class="section level2">
<h2>Processing the data - recap</h2>
<p>To recap, this roughly covers the data cleaning steps taken above:</p>
<ul>
<li><p>Import two Excel files:</p>
<ol style="list-style-type: decimal">
<li>single family home sales, and</li>
<li>condo &amp; townhome sales</li>
</ol></li>
<li>Replace spaces in column names with underscore and make lowercase</li>
<li>Rename some columns</li>
<li>Add <code>classification</code> column to <code>single_family</code> dataset
<ul>
<li>Set all values to “Single Family”</li>
</ul></li>
<li>Use <code>bind_rows()</code> to combine the datasets into one</li>
<li><p>Remove “Garage Only” observations</p></li>
</ul>
<p>No two datasets are alike. Each dataset is messy in its own way. The cleaning steps above are pretty typical. The only way of the steps required to clean a dataset is by jumping in and exploring the data!</p>
</div>
<div id="glimpse-of-final-dataset" class="section level2">
<h2>Glimpse of final dataset</h2>
<pre class="r"><code>glimpse(home_sales)</code></pre>
<pre><code>## Observations: 1,967
## Variables: 14
## $ account             &lt;chr&gt; &quot;R340967&quot;, &quot;R340073&quot;, &quot;R112063&quot;, &quot;R580140&quot;...
## $ parcel_number       &lt;chr&gt; &quot;239334401005&quot;, &quot;239334200010&quot;, &quot;239335100...
## $ reception           &lt;chr&gt; &quot;879240&quot;, &quot;870778&quot;, &quot;869383&quot;, &quot;857328&quot;, &quot;8...
## $ sale_date           &lt;chr&gt; &quot;6/29/2016&quot;, &quot;11/24/2015&quot;, &quot;10/13/2015&quot;, &quot;...
## $ sale_price          &lt;dbl&gt; 650000, 560000, 2750000, 630500, 2800000, ...
## $ situs_address       &lt;chr&gt; &quot;000066 N 2ND ST&quot;, &quot;000276 10TH ST&quot;, &quot;0008...
## $ location            &lt;chr&gt; &quot;CARBONDALE&quot;, &quot;CARBONDALE&quot;, &quot;CARBONDALE&quot;, ...
## $ architectural_style &lt;chr&gt; &quot;ONE STORY&quot;, &quot;ONE STORY&quot;, &quot;ONE STORY&quot;, &quot;ON...
## $ year_built          &lt;dbl&gt; 1970, 1971, 2002, 1999, 2008, 1994, 1993, ...
## $ bedrooms            &lt;dbl&gt; 0, 1, 0, 1, 2, 1, 1, 1, 2, 2, 1, 2, 2, 2, ...
## $ baths               &lt;dbl&gt; 0.00, 1.00, 0.75, 1.00, 1.00, 1.00, 1.00, ...
## $ square_feet         &lt;dbl&gt; 0, 480, 680, 710, 764, 804, 825, 957, 960,...
## $ legal               &lt;chr&gt; &quot;Section: 34 Township: 7 Range: 88 Subdivi...
## $ classification      &lt;chr&gt; &quot;Single Family&quot;, &quot;Single Family&quot;, &quot;Single ...</code></pre>
</div>
